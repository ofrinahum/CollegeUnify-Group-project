<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Task Management</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.11.0/main.min.css">
</head>
<body>
<div class="container mt-5">
    <h1 class="text-center">Task Management</h1>

    <!-- Calendar -->
    <div id="calendar" class="mb-4"></div>

    <!-- Create New Task Button -->
    <button class="btn btn-primary mb-3" data-toggle="modal" data-target="#taskModal">Create New Task</button>

    <!-- Modal for Task Form -->
    <div class="modal fade" id="taskModal" tabindex="-1" role="dialog" aria-labelledby="taskModalLabel" aria-hidden="true">
        <div class="modal-dialog" role="document">
            <div class="modal-content">
                <form id="taskForm" method="POST" action="/tasks/add">
                    <input type="hidden" name="_csrf" th:value="${_csrf.token}"/>

                    <div class="modal-header">
                        <h5 class="modal-title" id="taskModalLabel">Add Task</h5>
                        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>

                    <div class="modal-body">
                        <div class="form-group">
                            <label for="title">Title</label>
                            <input type="text" class="form-control" id="title" name="title" required>
                        </div>

                        <div class="form-group">
                            <label for="description">Description</label>
                            <textarea class="form-control" id="description" name="description" rows="3"></textarea>
                        </div>

                        <!-- Priority Field -->
                        <div class="form-group" id="priorityField">
                            <label for="priority">Priority</label>
                            <select class="form-control" id="priority" name="priority">
                                <option value="low">Low</option>
                                <option value="medium">Medium</option>
                                <option value="high">High</option>
                            </select>
                        </div>

                        <div class="form-group">
                            <label for="type">Task Type</label>
                            <select class="form-control" id="type" name="type" onchange="toggleFields()" required>
                                <option value="homework">Homework</option>
                                <option value="project">Project</option>
                                <option value="test">Test</option>
                                <option value="personal">Personal</option>
                                <option value="class">Class</option>
                            </select>
                        </div>

                        <!-- Homework/Project Due Date -->
                        <div class="form-group" id="dueDateField">
                            <label for="due_date">Due Date</label>
                            <input type="date" class="form-control" id="dueDate" name="dueDate">
                            <label for="due_time">Due Time</label> 
                            <input type="time" class="form-control" id="dueTime" name="dueTime">
                        </div>
                            


                        <!-- Test and Personal Fields -->
                            <div class="form-group" id = "eventDateField" style = "display: none;">
                                <label for="event_date">Event Date</label>
                                <input type="date" class="form-control" id="eventDate" name="eventDate">
                            </div>

                            <div class="form-group" id = "startEndField" style = "display: none;">
                                <label for="start_time">Start Time</label>
                                <input type="time" class="form-control" id="startTime" name="startTime">
                                <label for="end_time">End Time</label>
                                <input type="time" class="form-control" id="endTime" name="endTime">
                            </div>

                        <!-- Class Fields -->
                        <div id="classFields" style="display: none;">
                            <div class="form-group">
                                <label for="start_date">Start Date</label>
                                <input type="date" class="form-control" id="classStartDate" name="startDate">
                            </div>
                            <div class="form-group">
                                <label for="end_date">End Date</label>
                                <input type="date" class="form-control" id="classEndDate" name="endDate">
                            </div>
                            <div class="form-group">
                                <label for="repeat_pattern">Repeat Frequency</label>
                                <select class="form-control" id="classRepeatPattern" name="repeatPattern">
                                    <option value="" selected hidden>None</option>
                                    <option value="daily">Daily</option>
                                    <option value="weekly">Weekly</option>
                                    <option value="bi-weekly">Bi-Weekly</option>
                                    <option value="monthly">Monthly</option>
                                </select>
                            </div>                            
                            <div id="repeatDaysClass" style="display: none;">
                                <label>Repeat On</label>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Monday" id="mondayClass" name="repeatDays">
                                    <label class="form-check-label" for="day">Monday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Tuesday" id="tuesdayClass" name="repeatDays">
                                    <label class="form-check-label" for="day">Tuesday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Wednesday" id="wednesdayClass" name="repeatDays">
                                    <label class="form-check-label" for="day">Wednesday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Thursday" id="thursdayClass" name="repeatDays">
                                    <label class="form-check-label" for="day">Thursday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Friday" id="fridayClass" name="repeatDays">
                                    <label class="form-check-label" for="day">Friday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Saturday" id="saturdayClass" name="repeatDays">
                                    <label class="form-check-label" for="day">Saturday</label>
                                </div>
                                <div class="form-check">
                                    <input class="form-check-input" type="checkbox" value="Sunday" id="sundayClass" name="repeatDays">
                                    <label class="form-check-label" for="day">Sunday</label>
                                </div>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="submit" class="btn btn-success">Save Task</button>
                        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.8/dist/umd/popper.min.js"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.5.2/js/bootstrap.min.js"></script>
    <script>
function toggleFields() {
    const type = document.getElementById('type').value;
    const isRepeatingCheckbox = document.getElementById('isRepeating');
    const repeatPatternField = document.getElementById('personalRepeatPattern');

    // Show/hide fields based on task type
    const eventDateField = document.getElementById('eventDateField');
    const startEndField = document.getElementById('startEndField')
    const dueDateField = document.getElementById('dueDateField');
    const priorityField = document.getElementById('priorityField');
    const classFields = document.getElementById('classFields');

    dueDateField.style.display = 'none';
    priorityField.style.display = 'none';
    eventDateField.style.display = 'none';
    startEndField.style.display = 'none';
    classFields.style.display = 'none';

    if(type === 'homework' || type === 'project'){
        dueDateField.style.display = 'block';
    }

    if(type === 'homework' || type === 'test' || type === 'project'){
        priorityField.style.display = 'block';
    }

    if(type === 'test' || type === 'personal'){
        eventDateField.style.display = 'block';
        startEndField.style.display = 'block';
    }

    if(type === 'class'){
        startEndField.style.display = 'block';
        classFields.style.display = 'block';
    }
    }

    
function handleRepeatDays(type) {
    const repeatPattern = document.getElementById(type + 'RepeatPattern').value;
    const repeatDaysSection = document.getElementById('repeatDaysClass');

    if (repeatPattern === 'daily') {
        // Hide the repeat days section for daily repeat
        repeatDaysSection.style.display = 'none';

        // Automatically check all days
        const checkboxes = repeatDaysSection.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => checkbox.checked = true);
    } else if (repeatPattern === 'weekly' || repeatPattern === 'bi-weekly' || repeatPattern === 'monthly') {
        // Show the repeat days section for weekly, bi-weekly, or monthly repeat patterns
        repeatDaysSection.style.display = 'block';

        // Ensure no days are pre-checked initially
        const checkboxes = repeatDaysSection.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => checkbox.checked = false);
    } else {
        // If no pattern is selected, hide the repeat days section and clear selections
        repeatDaysSection.style.display = 'none';

        const checkboxes = repeatDaysSection.querySelectorAll('input[type="checkbox"]');
        checkboxes.forEach(checkbox => checkbox.checked = false);
    }
}

// Attach event listener to the repeat pattern dropdown for the 'class' type
document.getElementById('classRepeatPattern').addEventListener('change', function () {
    handleRepeatDays('class');
});


    
        document.addEventListener('DOMContentLoaded', function () {
    const form = document.getElementById('taskForm');
    const submitButton = document.querySelector('.btn-success');
    if (!form) {
        console.error("Form not found!");
        return;
    }

    submitButton.addEventListener('click', function () {
        console.log("Button clicked!");
        form.submit(); // Forces form submission
    });
});
    </script>
</body>
</html>
